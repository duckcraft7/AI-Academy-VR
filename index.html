<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>AI Academy VR - Corrigido</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <script>
        // --- COLOQUE SUA CHAVE AQUI ---
        const API_KEY = "AIzaSyCwTxeUHi_usF8GHBBRS6XmqPC7efeUzW8"; 

        async function buscarRespostaIA(materia) {
            // Mudamos de 'v1beta' para 'v1' para maior estabilidade
            const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${API_KEY}`;
            
            const prompt = {
                contents: [{
                    parts: [{
                        text: `Você é um professor de VR amigável. Ensine brevemente sobre ${materia}. Explique a lógica de 10 x 9 de forma didática. Não dê a resposta direto, guie o aluno.`
                    }]
                }]
            };

            try {
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(prompt)
                });

                const data = await response.json();
                
                // Se houver erro no modelo, tentamos uma alternativa comum
                if (data.error) {
                    console.error("Erro detalhado:", data.error);
                    return "Erro: " + data.error.message;
                }

                return data.candidates[0].content.parts[0].text;
            } catch (err) {
                return "Erro de conexão. Verifique o console.";
            }
        }

        function falar(texto) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(texto);
            msg.lang = 'pt-BR';
            window.speechSynthesis.speak(msg);
        }

        AFRAME.registerComponent('professor-logic', {
            init: function () {
                const el = this.el;
                const quadro = document.querySelector("#texto-quadro");
                const container = document.querySelector("#objetos-container");

                el.addEventListener('click', async () => {
                    quadro.setAttribute('value', "Aguarde, estou preparando a aula...");
                    falar("Deixe-me ver...");

                    const resposta = await buscarRespostaIA("Matemática (10 vezes 9)");
                    
                    quadro.setAttribute('value', resposta);
                    falar(resposta);

                    // Efeito Visual de Blocos
                    container.innerHTML = ""; 
                    for (let i = 0; i < 9; i++) {
                        let bloco = document.createElement("a-box");
                        bloco.setAttribute("position", `${(i * 0.7) - 2.8} 0.5 -3`);
                        bloco.setAttribute("color", "#3498db");
                        bloco.setAttribute("scale", "0.5 1.5 0.5");
                        bloco.setAttribute("animation", "property: position; from: "+((i*0.7)-2.8)+" -2 -3; to: "+((i*0.7)-2.8)+" 0.5 -3; dur: 1000; delay: " + (i * 150));
                        container.appendChild(bloco);
                    }
                });
            }
        });
    </script>
</head>
<body>
    <a-scene>
        <a-entity camera look-controls position="0 1.6 0">
            <a-cursor color="yellow"></a-cursor>
        </a-entity>

        <a-sky color="#0f0f1f"></a-sky>

        <a-box position="0 3 -5" depth="0.1" height="3" width="8" color="#1a2530">
            <a-text id="texto-quadro" 
                    value="PROFESSOR IA\n\nClique na esfera amarela para começar." 
                    align="center" position="0 0 0.1" width="7" wrap-count="45"></a-text>
        </a-box>

        <a-sphere professor-logic position="0 0.5 -3" radius="0.4" color="#f1c40f"
                  animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; loop: true; dur: 1000">
        </a-sphere>

        <a-entity id="objetos-container"></a-entity>
        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#222"></a-plane>
    </a-scene>
</body>
</html>
        <a-grid></a-grid>
        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#222"></a-plane>
    </a-scene>
</body>
</html>
