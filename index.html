<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>AI Academy VR - Full Script</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <script>
        // CONFIGURAÇÃO DA API
        const API_KEY = "AIzaSyCwTxeUHi_usF8GHBBRS6XmqPC7efeUzW8"; 

        // 1. FUNÇÃO PARA FALAR COM O GEMINI
        async function buscarRespostaIA(materia) {
            const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            
            const prompt = {
                contents: [{
                    parts: [{
                        text: `Você é um professor de VR amigável. Ensine brevemente sobre ${materia}. 
                               Foque em explicar 10 x 9 de forma didática. 
                               Não dê a resposta de imediato, ensine o processo.`
                    }]
                }]
            };

            try {
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(prompt)
                });

                const data = await response.json();
                
                if (data.error) {
                    console.error("Erro na API:", data.error.message);
                    return "Erro na API: " + data.error.message;
                }

                return data.candidates[0].content.parts[0].text;
            } catch (err) {
                console.error("Erro de conexão:", err);
                return "Erro de conexão. Verifique o console.";
            }
        }

        // 2. FUNÇÃO DE VOZ (TEXT-TO-SPEECH)
        function falar(texto) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(texto);
            msg.lang = 'pt-BR';
            msg.rate = 1.1;
            window.speechSynthesis.speak(msg);
        }

        // 3. COMPONENTE DE INTERAÇÃO DO VR
        AFRAME.registerComponent('professor-logic', {
            init: function () {
                const el = this.el;
                const quadro = document.querySelector("#texto-quadro");
                const container = document.querySelector("#objetos-container");

                el.addEventListener('click', async () => {
                    // Feedback visual inicial
                    quadro.setAttribute('value', "Chamando o professor... Aguarde.");
                    falar("Deixe-me pensar um pouco sobre isso.");

                    // Busca resposta na IA
                    const resposta = await buscarRespostaIA("Matematica (10 vezes 9)");
                    
                    // Atualiza o quadro e fala
                    quadro.setAttribute('value', resposta);
                    falar(resposta);

                    // Gera os blocos 3D (Representando 9 grupos de 10)
                    container.innerHTML = ""; // Limpa a sala antes
                    for (let i = 0; i < 9; i++) {
                        let bloco = document.createElement("a-box");
                        bloco.setAttribute("position", `${(i * 0.7) - 2.8} 0.5 -3`);
                        bloco.setAttribute("color", "#3498db");
                        bloco.setAttribute("scale", "0.5 1.5 0.5");
                        bloco.setAttribute("animation", "property: position; from: "+((i*0.7)-2.8)+" -2 -3; to: "+((i*0.7)-2.8)+" 0.5 -3; dur: 1000; delay: " + (i * 150));
                        container.appendChild(bloco);
                    }
                });
            }
        });
    </script>
</head>
<body>
    <a-scene>
        <a-entity camera look-controls position="0 1.6 0">
            <a-cursor color="yellow" fuse="true" fuse-timeout="1500"></a-cursor>
        </a-entity>

        <a-sky color="#0f0f1f"></a-sky>
        <a-light type="ambient" color="#fff" intensity="0.5"></a-light>
        <a-light type="directional" position="1 1 1" intensity="0.8"></a-light>

        <a-box position="0 3 -5" depth="0.1" height="3" width="8" color="#1a2530">
            <a-text id="texto-quadro" 
                    value="BEM-VINDO A SALA DE IA.\n\nOlhe para a esfera dourada para começar a aula." 
                    align="center" position="0 0 0.1" width="7" wrap-count="45"></a-text>
        </a-box>

        <a-sphere professor-logic position="0 0.5 -3" radius="0.4" color="#f1c40f"
                  animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
            <a-text value="CLIQUE AQUI" align="center" position="0 0.8 0" width="5"></a-text>
        </a-sphere>

        <a-entity id="objetos-container"></a-entity>

        <a-grid></a-grid>
        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#222"></a-plane>
    </a-scene>
</body>
</html>
